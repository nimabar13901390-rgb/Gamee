<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>God 3D Engine â€“ Ù…Ø­ÛŒØ· Ù‚Ø§Ø¨Ù„ Ø¯ÛŒØ¯Ù†</title>
<style>
  body { margin:0; overflow:hidden; background:#87ceeb; }
  canvas { display:block; }
  #info {
    position:absolute; top:10px; left:10px;
    color:white; font-family:sans-serif;
    background: rgba(0,0,0,0.4); padding:8px 12px; border-radius:8px; z-index:10;
  }
  #joystick {
    position:absolute; bottom:20px; left:20px;
    width:120px; height:120px;
    border-radius:50%; background:rgba(255,255,255,0.2);
    touch-action:none; z-index:10;
  }
  #stick {
    position:absolute; width:50px; height:50px;
    border-radius:50%; background:rgba(255,255,255,0.5);
    left:35px; top:35px;
  }
</style>
</head>
<body>
<div id="info">
ğŸŒ Ù…Ø­ÛŒØ· Ø³Ù‡â€ŒØ¨Ø¹Ø¯ÛŒ Ù‚Ø§Ø¨Ù„ Ø¯ÛŒØ¯Ù† | Joystick: Ø­Ø±Ú©Øª | F: Ø²Ù…ÛŒÙ†/ÙØ¶Ø§
</div>
<div id="joystick"><div id="stick"></div></div>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.166.0/build/three.module.js';
import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.166.0/examples/jsm/controls/OrbitControls.js';

let scene, camera, renderer, controls, player;
let clock = new THREE.Clock();
let spaceMode=false;
let moveX=0, moveZ=0;

init();
animate();

function init(){
  scene = new THREE.Scene();

  // Ø¢Ø³Ù…Ø§Ù† Ùˆ Ù†ÙˆØ± Ù…Ø­ÛŒØ·ÛŒ
  scene.background = new THREE.Color(0x87ceeb); // Ø¢Ø³Ù…Ø§Ù† Ø¢Ø¨ÛŒ Ø±ÙˆØ´Ù†
  const ambient = new THREE.AmbientLight(0xffffff,0.6); scene.add(ambient);
  const sun = new THREE.DirectionalLight(0xffffff,1);
  sun.position.set(100,200,100); sun.castShadow=true; scene.add(sun);

  // Ø¯ÙˆØ±Ø¨ÛŒÙ†
  camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,5000);
  camera.position.set(0,5,15);

  // Renderer
  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth,window.innerHeight);
  renderer.shadowMap.enabled=true;
  document.body.appendChild(renderer.domElement);

  // Ú©Ù†ØªØ±Ù„ Ø³ÙˆÙ…â€ŒØ´Ø®Øµ
  controls = new OrbitControls(camera,renderer.domElement);
  controls.enablePan=false; controls.enableDamping=true;
  controls.maxDistance=500; controls.minDistance=5;

  // Ø²Ù…ÛŒÙ† Ø¨Ø§ Ø¨Ø§ÙØª Ø³Ø§Ø¯Ù‡ Ú†Ù…Ù†
  const textureLoader = new THREE.TextureLoader();
  const groundTexture = textureLoader.load('https://threejs.org/examples/textures/grasslight-big.jpg');
  groundTexture.wrapS = groundTexture.wrapT = THREE.RepeatWrapping;
  groundTexture.repeat.set(25,25);
  const groundGeo = new THREE.PlaneGeometry(1000,1000,128,128);
  const groundMat = new THREE.MeshStandardMaterial({map:groundTexture});
  const ground = new THREE.Mesh(groundGeo,groundMat);
  ground.rotation.x=-Math.PI/2; ground.receiveShadow=true; scene.add(ground);

  // Ø¨Ø§Ø²ÛŒÚ©Ù†
  const playerGeo = new THREE.SphereGeometry(1,32,32);
  const playerMat = new THREE.MeshStandardMaterial({color:0xffcc00});
  player = new THREE.Mesh(playerGeo,playerMat);
  player.position.y=1; player.castShadow=true; scene.add(player);

  // Ø³ØªØ§Ø±Ù‡â€ŒÙ‡Ø§ (Ø­Ø§Ù„Øª ÙØ¶Ø§)
  const starGeo = new THREE.BufferGeometry();
  const starCount=10000; const positions=[];
  for(let i=0;i<starCount;i++){
    positions.push((Math.random()-0.5)*5000);
    positions.push((Math.random()-0.5)*5000);
    positions.push((Math.random()-0.5)*5000);
  }
  starGeo.setAttribute('position',new THREE.Float32BufferAttribute(positions,3));
  const stars = new THREE.Points(starGeo,new THREE.PointsMaterial({color:0xffffff,size:1}));
  stars.visible=false; scene.add(stars);

  // Ú©Ù„ÛŒØ¯ F Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ø²Ù…ÛŒÙ†/ÙØ¶Ø§
  document.addEventListener('keydown',e=>{
    if(e.key.toLowerCase()==='f'){
      spaceMode=!spaceMode;
      stars.visible=spaceMode;
      ground.visible=!spaceMode;
      if(spaceMode) player.position.set(0,500,0); else player.position.set(0,1,0);
    }
  });

  // joystick
  const stick = document.getElementById('stick');
  const joystick = document.getElementById('joystick');
  let active=false, startX=0, startY=0;
  const maxRadius=40;

  joystick.addEventListener('pointerdown',e=>{active=true; startX=e.clientX; startY=e.clientY;});
  joystick.addEventListener('pointermove',e=>{
    if(!active) return;
    let dx=e.clientX-startX, dy=e.clientY-startY;
    const dist=Math.sqrt(dx*dx+dy*dy);
    if(dist>maxRadius){dx=(dx/dist)*maxRadius; dy=(dy/dist)*maxRadius;}
    stick.style.left=`${35+dx}px`; stick.style.top=`${35+dy}px`;
    moveX=dx/maxRadius; moveZ=dy/maxRadius;
  });
  joystick.addEventListener('pointerup',e=>{active=false; stick.style.left='35px'; stick.style.top='35px'; moveX=0; moveZ=0;});

  function animateLoop(){
    requestAnimationFrame(animateLoop);
    const speed = spaceMode?5:0.5;
    player.position.x += moveX*speed;
    player.position.z -= moveZ*speed;
    controls.target.copy(player.position);
    controls.update();
    renderer.render(scene,camera);
  }
  animateLoop();

  window.addEventListener('resize',()=>{
    camera.aspect=window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
  });
}

function animate(){ requestAnimationFrame(animate); renderer.render(scene,camera); }
</script>
</body>
</html>
