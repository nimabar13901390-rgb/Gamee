<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>جنگنده فضایی</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: none;
        }
        
        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            overflow: hidden;
            padding: 10px;
        }
        
        .game-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            background: linear-gradient(45deg, #00dbde, #fc00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 10px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .game-canvas {
            background: radial-gradient(circle at center, #0a0a2a 0%, #06061a 50%, #000000 100%);
            border: 2px solid #00dbde;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 219, 222, 0.5);
            display: block;
            width: 100%;
            height: 600px;
            max-height: 70vh;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 12px;
            z-index: 10;
        }
        
        .screen h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #00dbde;
            text-shadow: 0 0 15px rgba(0, 219, 222, 0.8);
        }
        
        .screen p {
            font-size: 0.95rem;
            margin-bottom: 10px;
            text-align: center;
            line-height: 1.5;
            color: #fc00ff;
            padding: 0 20px;
        }
        
        .btn {
            background: linear-gradient(45deg, #00dbde, #fc00ff);
            color: white;
            border: none;
            padding: 14px 36px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 40px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(252, 0, 255, 0.6);
            z-index: 20;
            position: relative;
        }
        
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(252, 0, 255, 0.8);
        }
        
        .controls {
            margin-top: 20px;
            text-align: center;
            color: #00dbde;
            font-size: 0.85rem;
            line-height: 1.4;
            padding: 0 15px;
        }
        
        .hidden {
            display: none;
        }
        
        .boundary-line {
            stroke: #ff0000;
            stroke-width: 2;
            stroke-dasharray: 8, 4;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>⚔️ جنگنده فضایی ⚔️</h1>
            <div class="stats">
                <div class="stat-item">
                    <span>امتیاز: </span>
                    <span id="score">0</span>
                </div>
                <div class="stat-item">
                    <span>جان: </span>
                    <span id="lives">3</span>
                </div>
                <div class="stat-item">
                    <span>سطح: </span>
                    <span id="level">1</span>
                </div>
            </div>
        </div>
        
        <svg id="gameCanvas" class="game-canvas" viewBox="0 0 400 600">
            <defs>
                <linearGradient id="playerGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" stop-color="#4ade80" />
                    <stop offset="100%" stop-color="#22d3ee" />
                </linearGradient>
                <linearGradient id="enemy1Gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" stop-color="#ef4444" />
                    <stop offset="100%" stop-color="#dc2626" />
                </linearGradient>
                <linearGradient id="enemy2Gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" stop-color="#f97316" />
                    <stop offset="100%" stop-color="#ea580c" />
                </linearGradient>
                <linearGradient id="enemy3Gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" stop-color="#8b5cf6" />
                    <stop offset="100%" stop-color="#7c3aed" />
                </linearGradient>
                <linearGradient id="bulletGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" stop-color="#fbbf24" />
                    <stop offset="100%" stop-color="#f59e0b" />
                </linearGradient>
                <linearGradient id="starGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#ffffff" />
                    <stop offset="100%" stop-color="#e5e7eb" />
                </linearGradient>
            </defs>
            
            <!-- Stars -->
            <g id="stars"></g>
            
            <!-- Boundary Line -->
            <line x1="0" y1="560" x2="400" y2="560" class="boundary-line" />
            
            <!-- Game Objects -->
            <g id="gameObjects"></g>
            
            <!-- Menu Screen -->
            <rect x="0" y="0" width="400" height="600" fill="rgba(0,0,0,0.9)" rx="12" class="screen" id="menuScreen"/>
            <text x="200" y="200" text-anchor="middle" font-size="24" fill="#00dbde" font-weight="bold" class="screen-text" id="menuTitle">🚀 جنگنده فضایی 🚀</text>
            <text x="200" y="240" text-anchor="middle" font-size="14" fill="#fc00ff" class="screen-text">دشمنان فضایی از سمت بالا حمله می‌کنند!</text>
            <text x="200" y="265" text-anchor="middle" font-size="14" fill="#fc00ff" class="screen-text">با شلیک گلوله‌های زرد آنها را نابود کنید</text>
            <text x="200" y="290" text-anchor="middle" font-size="14" fill="#fc00ff" class="screen-text">جلوی عبور دشمنان از خط قرمز را بگیرید</text>
            <rect x="150" y="320" width="100" height="40" rx="20" fill="url(#bulletGradient)" class="btn-rect" id="startBtn"/>
            <text x="200" y="345" text-anchor="middle" font-size="16" fill="white" font-weight="bold" class="btn-text">شروع بازی</text>
            
            <!-- Game Over Screen -->
            <rect x="0" y="0" width="400" height="600" fill="rgba(0,0,0,0.9)" rx="12" class="screen hidden" id="gameOverScreen"/>
            <text x="200" y="200" text-anchor="middle" font-size="24" fill="#ef4444" font-weight="bold" class="screen-text hidden" id="gameOverTitle">💀 بازی تمام شد 💀</text>
            <text x="200" y="240" text-anchor="middle" font-size="16" fill="#fc00ff" class="screen-text hidden" id="finalScoreText">امتیاز نهایی: 0</text>
            <rect x="150" y="280" width="100" height="40" rx="20" fill="url(#bulletGradient)" class="btn-rect hidden" id="restartBtn"/>
            <text x="200" y="305" text-anchor="middle" font-size="16" fill="white" font-weight="bold" class="btn-text hidden" id="restartBtnText">بازی دوباره</text>
        </svg>
    </div>

    <script>
        // Game variables
        let gameState = 'menu'; // 'menu', 'playing', 'gameOver'
        let score = 0;
        let lives = 3;
        let level = 1;
        let player = { x: 180, y: 520, width: 40, height: 40 };
        let bullets = [];
        let enemies = [];
        let explosions = [];
        let frameCount = 0;
        let gameLoop;
        let isTouching = false;
        let touchX = 0;
        
        // DOM Elements
        const gameCanvas = document.getElementById('gameCanvas');
        const gameObjects = document.getElementById('gameObjects');
        const menuScreen = document.getElementById('menuScreen');
        const menuTitle = document.getElementById('menuTitle');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const gameOverTitle = document.getElementById('gameOverTitle');
        const finalScoreText = document.getElementById('finalScoreText');
        const scoreElement = document.getElementById('score');
        const livesElement = document.getElementById('lives');
        const levelElement = document.getElementById('level');
        
        // Create stars
        function createStars() {
            const starsGroup = document.getElementById('stars');
            for (let i = 0; i < 80; i++) {
                const star = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                star.setAttribute('cx', Math.random() * 400);
                star.setAttribute('cy', Math.random() * 600);
                star.setAttribute('r', Math.random() * 1.5);
                star.setAttribute('fill', 'url(#starGradient)');
                star.setAttribute('opacity', Math.random() * 0.6 + 0.4);
                starsGroup.appendChild(star);
            }
        }
        
        // Draw player (real fighter jet)
        function drawPlayer() {
            const playerGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            playerGroup.setAttribute('transform', `translate(${player.x}, ${player.y})`);
            
            // Main body
            const body = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            body.setAttribute('d', 'M20,0 L35,10 L30,15 L25,15 L25,35 L15,35 L15,15 L10,15 L5,10 Z');
            body.setAttribute('fill', 'url(#playerGradient)');
            body.setAttribute('stroke', '#22d3ee');
            body.setAttribute('stroke-width', '1.5');
            playerGroup.appendChild(body);
            
            // Cockpit
            const cockpit = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
            cockpit.setAttribute('cx', '20');
            cockpit.setAttribute('cy', '8');
            cockpit.setAttribute('rx', '6');
            cockpit.setAttribute('ry', '4');
            cockpit.setAttribute('fill', '#bbf7d0');
            cockpit.setAttribute('opacity', '0.8');
            playerGroup.appendChild(cockpit);
            
            // Wings
            const leftWing = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            leftWing.setAttribute('d', 'M15,20 L5,25 L10,30 L15,25 Z');
            leftWing.setAttribute('fill', '#22d3ee');
            playerGroup.appendChild(leftWing);
            
            const rightWing = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            rightWing.setAttribute('d', 'M25,20 L35,25 L30,30 L25,25 Z');
            rightWing.setAttribute('fill', '#22d3ee');
            playerGroup.appendChild(rightWing);
            
            return playerGroup;
        }
        
        // Draw bullet (yellow circle)
        function drawBullet(bullet) {
            const bulletCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            bulletCircle.setAttribute('cx', bullet.x);
            bulletCircle.setAttribute('cy', bullet.y);
            bulletCircle.setAttribute('r', bullet.radius);
            bulletCircle.setAttribute('fill', 'url(#bulletGradient)');
            bulletCircle.setAttribute('stroke', '#fbbf24');
            bulletCircle.setAttribute('stroke-width', '1');
            return bulletCircle;
        }
        
        // Draw different enemy types
        function drawEnemy(enemy) {
            const enemyGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            enemyGroup.setAttribute('transform', `translate(${enemy.x}, ${enemy.y})`);
            
            if (enemy.type === 1) {
                // Red enemy - basic fighter
                const body = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                body.setAttribute('d', 'M17.5,0 L30,8 L25,12 L20,12 L20,30 L15,30 L15,12 L10,12 L5,8 Z');
                body.setAttribute('fill', 'url(#enemy1Gradient)');
                body.setAttribute('stroke', '#ef4444');
                body.setAttribute('stroke-width', '1.5');
                enemyGroup.appendChild(body);
                
                const cockpit = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                cockpit.setAttribute('cx', '17.5');
                cockpit.setAttribute('cy', '6');
                cockpit.setAttribute('r', '3');
                cockpit.setAttribute('fill', '#fecaca');
                enemyGroup.appendChild(cockpit);
            } 
            else if (enemy.type === 2) {
                // Orange enemy - bomber
                const body = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                body.setAttribute('x', '10');
                body.setAttribute('y', '5');
                body.setAttribute('width', '15');
                body.setAttribute('height', '25');
                body.setAttribute('rx', '7');
                body.setAttribute('fill', 'url(#enemy2Gradient)');
                body.setAttribute('stroke', '#f97316');
                body.setAttribute('stroke-width', '1.5');
                enemyGroup.appendChild(body);
                
                const wings = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                wings.setAttribute('d', 'M5,15 L10,12 L10,18 Z M30,15 L25,12 L25,18 Z');
                wings.setAttribute('fill', '#f97316');
                enemyGroup.appendChild(wings);
            }
            else {
                // Purple enemy - advanced fighter
                const body = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                body.setAttribute('d', 'M17.5,0 L28,10 L22,15 L18,15 L18,32 L17,32 L17,15 L13,15 L7,10 Z');
                body.setAttribute('fill', 'url(#enemy3Gradient)');
                body.setAttribute('stroke', '#8b5cf6');
                body.setAttribute('stroke-width', '1.5');
                enemyGroup.appendChild(body);
                
                const cockpit = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
                cockpit.setAttribute('cx', '17.5');
                cockpit.setAttribute('cy', '8');
                cockpit.setAttribute('rx', '4');
                cockpit.setAttribute('ry', '3');
                cockpit.setAttribute('fill', '#ede9fe');
                enemyGroup.appendChild(cockpit);
            }
            
            return enemyGroup;
        }
        
        // Draw explosion
        function drawExplosion(explosion) {
            const explosionCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            explosionCircle.setAttribute('cx', explosion.x);
            explosionCircle.setAttribute('cy', explosion.y);
            explosionCircle.setAttribute('r', explosion.radius);
            explosionCircle.setAttribute('fill', 'none');
            explosionCircle.setAttribute('stroke', '#fbbf24');
            explosionCircle.setAttribute('stroke-width', '2');
            explosionCircle.setAttribute('opacity', explosion.life / 15);
            return explosionCircle;
        }
        
        // Check collision
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }
        
        // Shoot bullet
        function shoot() {
            bullets.push({
                x: player.x + player.width / 2,
                y: player.y,
                radius: 4,
                width: 8,
                height: 8
            });
        }
        
        // Spawn enemy (different types)
        function spawnEnemy() {
            const enemyType = Math.random() < 0.6 ? 1 : Math.random() < 0.8 ? 2 : 3;
            let width = 35, height = 35;
            if (enemyType === 2) {
                width = 25;
                height = 30;
            } else if (enemyType === 3) {
                width = 30;
                height = 32;
            }
            
            enemies.push({
                x: Math.random() * (400 - width),
                y: -height,
                width: width,
                height: height,
                speed: 1.5 + (level - 1) * 0.3, // Slower speed
                type: enemyType
            });
        }
        
        // Create explosion
        function createExplosion(x, y) {
            explosions.push({
                x: x + 17.5,
                y: y + 17.5,
                radius: 0,
                maxRadius: 25,
                life: 15
            });
        }
        
        // Update game state
        function updateGame() {
            if (gameState !== 'playing') return;
            
            // Move player based on touch
            if (isTouching) {
                player.x = Math.max(0, Math.min(400 - player.width, touchX - player.width / 2));
            }
            
            // Update bullets
            bullets = bullets
                .map(bullet => ({ ...bullet, y: bullet.y - 8 }))
                .filter(bullet => bullet.y > -10);
            
            // Update enemies
            enemies = enemies
                .map(enemy => ({ ...enemy, y: enemy.y + enemy.speed }))
                .filter(enemy => enemy.y < 600 + enemy.height);
            
            // Spawn enemies
            frameCount++;
            if (frameCount % Math.max(40, 80 - level * 8) === 0) {
                spawnEnemy();
            }
            
            // Update explosions
            explosions = explosions
                .map(explosion => ({
                    ...explosion,
                    radius: Math.min(explosion.maxRadius, explosion.radius + 1.5),
                    life: explosion.life - 1
                }))
                .filter(explosion => explosion.life > 0);
            
            // Check bullet-enemy collisions
            for (let i = bullets.length - 1; i >= 0; i--) {
                for (let j = enemies.length - 1; j >= 0; j--) {
                    if (checkCollision(bullets[i], enemies[j])) {
                        bullets.splice(i, 1);
                        createExplosion(enemies[j].x, enemies[j].y);
                        enemies.splice(j, 1);
                        score += 10 * (enemies[j]?.type || 1);
                        scoreElement.textContent = score;
                        break;
                    }
                }
            }
            
            // Check player-enemy collisions
            for (let i = enemies.length - 1; i >= 0; i--) {
                if (checkCollision(player, enemies[i])) {
                    createExplosion(en
